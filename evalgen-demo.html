<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EvalGen Â· AI è¯„æµ‹è®¾è®¡åŠ©æ‰‹</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #0f0f0f;
    --paper: #f7f5f0;
    --cream: #ede9e0;
    --accent: #1a4fff;
    --accent-light: #e8eeff;
    --accent-dark: #0d2db3;
    --warn: #ff6b2b;
    --warn-light: #fff0e8;
    --success: #00875a;
    --success-light: #e3faf1;
    --muted: #6b6860;
    --border: #d8d4ca;
    --shadow: 0 2px 12px rgba(15,15,15,0.08);
    --shadow-lg: 0 8px 40px rgba(15,15,15,0.12);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--paper);
    color: var(--ink);
    min-height: 100vh;
    font-size: 14px;
    line-height: 1.6;
  }

  .topbar {
    position: sticky; top: 0; z-index: 100;
    background: var(--ink);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 32px;
    height: 52px;
    border-bottom: 1px solid #222;
  }
  .topbar-logo {
    font-family: 'DM Serif Display', serif;
    font-size: 20px; color: var(--paper);
    letter-spacing: -0.5px;
    display: flex; align-items: center; gap: 10px;
  }
  .topbar-logo .badge {
    font-family: 'DM Mono', monospace;
    font-size: 10px; color: var(--accent);
    background: rgba(26,79,255,0.15);
    padding: 2px 7px; border-radius: 3px;
    letter-spacing: 0.5px;
  }

  .app {
    display: grid;
    grid-template-columns: 340px 1fr;
    min-height: calc(100vh - 52px);
  }

  .left-panel {
    background: white;
    border-right: 1px solid var(--border);
    overflow-y: auto;
    display: flex; flex-direction: column;
  }

  .panel-section {
    padding: 24px;
    border-bottom: 1px solid var(--border);
  }
  .panel-section:last-child { border-bottom: none; }

  .section-label {
    font-family: 'DM Mono', monospace;
    font-size: 10px; font-weight: 500;
    color: var(--muted);
    letter-spacing: 1px; text-transform: uppercase;
    margin-bottom: 14px;
    display: flex; align-items: center; gap: 8px;
  }
  .section-label::after {
    content: ''; flex: 1; height: 1px; background: var(--border);
  }

  .api-config-row { display: flex; gap: 8px; }
  .api-input {
    flex: 1;
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 9px 12px;
    background: var(--paper);
    color: var(--ink);
    outline: none;
    transition: border-color 0.2s;
  }
  .api-input:focus { border-color: var(--accent); background: white; }
  .api-input::placeholder { color: #bbb; }
  .api-hint {
    margin-top: 8px;
    font-size: 11px; color: var(--muted);
    line-height: 1.5;
  }

  .btn-sm {
    font-family: 'DM Mono', monospace;
    font-size: 11px; font-weight: 500;
    padding: 9px 14px;
    border-radius: 6px; border: none; cursor: pointer;
    white-space: nowrap;
    transition: all 0.15s;
  }
  .btn-primary { background: var(--accent); color: white; }
  .btn-primary:hover { background: var(--accent-dark); }
  .btn-secondary { background: var(--cream); color: var(--ink); }
  .btn-secondary:hover { background: var(--border); }

  .form-group { margin-bottom: 16px; }
  .form-label {
    font-size: 12px; font-weight: 600;
    color: var(--ink);
    margin-bottom: 6px;
    display: flex; align-items: center; gap: 6px;
  }
  .form-label .required { color: var(--warn); font-size: 11px; }
  .form-label .optional { font-weight: 400; color: var(--muted); font-size: 11px; }
  .form-input, .form-textarea, .form-select {
    width: 100%;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 9px 12px;
    background: var(--paper);
    color: var(--ink);
    outline: none;
    transition: border-color 0.2s, background 0.2s;
  }
  .form-input:focus, .form-textarea:focus, .form-select:focus {
    border-color: var(--accent); background: white;
    box-shadow: 0 0 0 3px rgba(26,79,255,0.08);
  }
  .form-textarea { resize: vertical; min-height: 80px; }
  .form-select { cursor: pointer; appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath d='M6 8L1 3h10z' fill='%236b6860'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 12px center;
  }

  .tag-group { display: flex; flex-wrap: wrap; gap: 6px; }
  .tag {
    font-size: 12px; padding: 5px 10px;
    border: 1px solid var(--border);
    border-radius: 20px; cursor: pointer;
    background: white; color: var(--muted);
    transition: all 0.15s; user-select: none;
  }
  .tag:hover { border-color: var(--accent); color: var(--accent); }
  .tag.active {
    background: var(--accent-light);
    border-color: var(--accent);
    color: var(--accent);
    font-weight: 500;
  }

  .generate-btn {
    width: 100%;
    background: var(--ink);
    color: var(--paper);
    font-family: 'DM Serif Display', serif;
    font-size: 16px;
    padding: 14px;
    border: none; border-radius: 8px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center; gap: 10px;
    transition: all 0.2s;
    letter-spacing: -0.3px;
  }
  .generate-btn:hover { background: #1a1a1a; transform: translateY(-1px); box-shadow: var(--shadow-lg); }
  .generate-btn:active { transform: translateY(0); }
  .generate-btn:disabled { background: #999; cursor: not-allowed; transform: none; box-shadow: none; }
  .generate-btn .spinner {
    width: 16px; height: 16px;
    border: 2px solid rgba(255,255,255,0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    display: none;
  }
  .generate-btn.loading .spinner { display: block; }
  .generate-btn.loading .btn-text { opacity: 0.7; }

  .right-panel {
    display: flex; flex-direction: column;
    overflow: hidden;
  }

  .output-header {
    background: white;
    border-bottom: 1px solid var(--border);
    padding: 0 32px;
    display: flex; align-items: center; justify-content: space-between;
    height: 52px;
    flex-shrink: 0;
  }

  .output-tabs { display: flex; gap: 0; height: 100%; }
  .tab {
    font-family: 'DM Mono', monospace;
    font-size: 11px; font-weight: 500;
    padding: 0 20px;
    border: none; background: none; cursor: pointer;
    color: var(--muted);
    border-bottom: 2px solid transparent;
    transition: all 0.15s;
    letter-spacing: 0.3px;
    display: flex; align-items: center; gap: 6px;
  }
  .tab:hover { color: var(--ink); }
  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

  .output-actions { display: flex; gap: 8px; align-items: center; }

  .output-body {
    flex: 1; overflow-y: auto;
    padding: 32px;
    position: relative;
  }

  .empty-state {
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    height: 100%;
    text-align: center;
  }
  .empty-state .big-text {
    font-family: 'DM Serif Display', serif;
    font-size: 48px; color: var(--border);
    line-height: 1; margin-bottom: 16px;
  }
  .empty-state .sub-text {
    font-size: 14px; color: var(--muted);
    max-width: 320px; line-height: 1.7;
  }
  .empty-state .hint-grid {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 10px; margin-top: 32px; max-width: 400px;
  }
  .hint-card {
    background: white; border: 1px solid var(--border);
    border-radius: 8px; padding: 14px;
    text-align: left;
  }
  .hint-card .hint-icon { font-size: 18px; margin-bottom: 6px; }
  .hint-card .hint-title { font-size: 12px; font-weight: 600; margin-bottom: 4px; }
  .hint-card .hint-desc { font-size: 11px; color: var(--muted); line-height: 1.5; }

  .loading-state {
    display: none;
    align-items: center; justify-content: center;
    height: 100%;
    flex-direction: column; gap: 24px;
  }
  .loading-state.active { display: flex; }
  .loading-state .loading-text {
    font-family: 'DM Serif Display', serif;
    font-size: 22px; color: var(--muted);
    letter-spacing: -0.5px;
  }
  .loading-steps { display: flex; flex-direction: column; gap: 10px; width: 280px; }
  .loading-step {
    display: flex; align-items: center; gap: 12px;
    font-size: 13px; color: var(--muted);
    transition: color 0.3s;
  }
  .loading-step .step-dot {
    width: 8px; height: 8px; border-radius: 50%;
    background: var(--border); flex-shrink: 0;
    transition: background 0.3s;
  }
  .loading-step.done .step-dot { background: var(--success); }
  .loading-step.active .step-dot { background: var(--accent); animation: pulse 1s infinite; }
  .loading-step.done { color: var(--ink); }
  .loading-step.active { color: var(--accent); font-weight: 500; }

  @keyframes pulse {
    0%,100% { box-shadow: 0 0 0 0 rgba(26,79,255,0.4); }
    50% { box-shadow: 0 0 0 6px rgba(26,79,255,0); }
  }

  .result-content { display: none; }
  .result-content.active { display: block; }

  .markdown-preview {
    background: white; border: 1px solid var(--border);
    border-radius: 10px; padding: 40px;
    max-width: 800px;
    box-shadow: var(--shadow);
    line-height: 1.8;
  }
  .markdown-preview h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 28px; color: var(--ink);
    border-bottom: 2px solid var(--border);
    padding-bottom: 12px; margin-bottom: 24px;
  }
  .markdown-preview h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 20px; color: var(--ink);
    margin-top: 32px; margin-bottom: 12px;
  }
  .markdown-preview h3 {
    font-size: 14px; font-weight: 600;
    color: var(--ink);
    margin-top: 20px; margin-bottom: 8px;
  }
  .markdown-preview p { margin-bottom: 12px; }
  .markdown-preview ul, .markdown-preview ol {
    padding-left: 20px; margin-bottom: 12px;
  }
  .markdown-preview li { margin-bottom: 4px; }
  .markdown-preview table {
    width: 100%; border-collapse: collapse;
    margin: 16px 0; font-size: 13px;
  }
  .markdown-preview th {
    background: var(--ink); color: var(--paper);
    padding: 10px 14px; text-align: left;
    font-weight: 600; font-size: 12px;
  }
  .markdown-preview td {
    padding: 9px 14px; border-bottom: 1px solid var(--border);
  }
  .markdown-preview tr:nth-child(even) td { background: var(--paper); }
  .markdown-preview blockquote {
    border-left: 3px solid var(--accent);
    padding: 8px 16px; margin: 16px 0;
    background: var(--accent-light);
    border-radius: 0 6px 6px 0;
  }
  .markdown-preview code {
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    background: var(--cream);
    padding: 2px 6px; border-radius: 3px;
  }

  .markdown-raw {
    background: #0f0f0f; border-radius: 10px;
    padding: 24px; overflow-x: auto;
    box-shadow: var(--shadow);
  }
  .markdown-raw pre {
    font-family: 'DM Mono', monospace;
    font-size: 12px; color: #d4d0c8;
    line-height: 1.7; white-space: pre-wrap;
  }

  .prompt-panel { display: flex; flex-direction: column; gap: 16px; }
  .prompt-block {
    border: 1px solid var(--border);
    border-radius: 10px; overflow: hidden;
    box-shadow: var(--shadow);
  }
  .prompt-block-header {
    padding: 12px 16px;
    display: flex; align-items: center; justify-content: space-between;
    border-bottom: 1px solid var(--border);
  }
  .prompt-block-header { background: var(--ink); }
  .prompt-block-header .prompt-title { color: var(--paper); }
  .prompt-title { font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
  .prompt-body { padding: 16px; background: white; }
  .prompt-textarea {
    width: 100%; min-height: 320px;
    font-family: 'DM Mono', monospace;
    font-size: 12px; line-height: 1.7;
    border: 1px solid var(--border); border-radius: 6px;
    padding: 12px; background: var(--paper); color: var(--ink);
    outline: none; resize: vertical;
    transition: border-color 0.2s;
  }
  .prompt-textarea:focus { border-color: var(--accent); background: white; }
  .prompt-actions { display: flex; gap: 8px; margin-top: 10px; }

  .toast {
    position: fixed; bottom: 24px; right: 24px; z-index: 300;
    background: var(--ink); color: var(--paper);
    padding: 12px 20px; border-radius: 8px;
    font-size: 13px; font-weight: 500;
    transform: translateY(80px); opacity: 0;
    transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
    box-shadow: var(--shadow-lg);
  }
  .toast.show { transform: translateY(0); opacity: 1; }

  @keyframes spin { to { transform: rotate(360deg); } }

  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
</style>
</head>
<body>

<div class="topbar">
  <div class="topbar-logo">
    EvalGen
    <span class="badge">BETA</span>
  </div>
</div>

<div class="app">

  <div class="left-panel">

    <div class="panel-section">
      <div class="section-label">API é…ç½®</div>
      <div class="api-config-row">
        <input type="password" class="api-input" id="apiKeyInput"
          placeholder="æ™ºè°± API Keyï¼ˆopen.bigmodel.cn è·å–ï¼Œé€‰å¡«ï¼‰">
        <button class="btn-sm btn-primary" onclick="saveApiKey()">ä¿å­˜</button>
      </div>
      <div class="api-hint">å¡«å†™æ™ºè°± GLM API Key å¯è°ƒç”¨çœŸå® API ç”Ÿæˆï¼ŒGLM-4-Flash æœ‰å…è´¹é¢åº¦ã€‚ç•™ç©ºåˆ™ä½¿ç”¨ Mock é¢„è§ˆã€‚</div>
    </div>

    <div class="panel-section" style="flex:1; overflow-y:auto;">
      <div class="section-label">é¡¹ç›®ä¿¡æ¯</div>

      <div class="form-group">
        <div class="form-label">åŠŸèƒ½æè¿° <span class="required">*</span></div>
        <textarea class="form-textarea" id="fDescription" rows="3"
          placeholder="ä¸€å¥è¯æè¿°è¿™ä¸ª AI åŠŸèƒ½åšä»€ä¹ˆ&#10;ç¤ºä¾‹ï¼šæ™ºèƒ½å®¢æœæœºå™¨äººè‡ªåŠ¨å›å¤ç”¨æˆ·å¸¸è§é—®é¢˜"></textarea>
      </div>

      <div class="form-group">
        <div class="form-label">ç”¨æˆ·åœºæ™¯ <span class="required">*</span></div>
        <textarea class="form-textarea" id="fScene" rows="3"
          placeholder="è°åœ¨ç”¨ã€åœ¨å“ªç”¨ã€è§£å†³ä»€ä¹ˆé—®é¢˜&#10;ç¤ºä¾‹ï¼šC ç«¯ç”¨æˆ·åœ¨ App å†…å’¨è¯¢ï¼ŒæœŸæœ›ç§’çº§å“åº”"></textarea>
      </div>

      <div class="form-group">
        <div class="form-label">æˆåŠŸå®šä¹‰ <span class="required">*</span></div>
        <textarea class="form-textarea" id="fSuccess" rows="2"
          placeholder="ä½ è®¤ä¸ºä»€ä¹ˆå«ã€Œæ•ˆæœå¥½ã€&#10;ç¤ºä¾‹ï¼šå›å¤å‡†ç¡®ã€ä¸äº§ç”Ÿå¹»è§‰ã€å“åº” â‰¤ 2s"></textarea>
      </div>

      <div class="form-group">
        <div class="form-label">æ—¶é—´å‹åŠ› <span class="optional">é€‰å¡«</span></div>
        <select class="form-select" id="fTime">
          <option value="tight">ç´§ï¼ˆ< 2 å‘¨ï¼‰</option>
          <option value="medium" selected>ä¸­ç­‰ï¼ˆ2â€“4 å‘¨ï¼‰</option>
          <option value="loose">å®½æ¾ï¼ˆ> 1 ä¸ªæœˆï¼‰</option>
        </select>
      </div>

      <div class="form-group">
        <div class="form-label">ç”¨æˆ·ç¾¤ä½“ <span class="optional">é€‰å¡«</span></div>
        <div class="tag-group" id="audienceTags">
          <span class="tag" onclick="toggleTag(this)">C ç«¯ç”¨æˆ·</span>
          <span class="tag" onclick="toggleTag(this)">B ç«¯ç”¨æˆ·</span>
          <span class="tag" onclick="toggleTag(this)">æœªæˆå¹´äºº</span>
          <span class="tag" onclick="toggleTag(this)">åŒ»ç–—åœºæ™¯</span>
          <span class="tag" onclick="toggleTag(this)">é‡‘èåœºæ™¯</span>
        </div>
      </div>

      <div class="form-group">
        <div class="form-label">è¾“å‡ºå½¢å¼ <span class="optional">é€‰å¡«</span></div>
        <div class="tag-group" id="outputTags">
          <span class="tag active" onclick="toggleTag(this)">æ–‡æœ¬</span>
          <span class="tag" onclick="toggleTag(this)">å›¾ç‰‡</span>
          <span class="tag" onclick="toggleTag(this)">è¯­éŸ³</span>
          <span class="tag" onclick="toggleTag(this)">ä»£ç </span>
          <span class="tag" onclick="toggleTag(this)">ç»“æ„åŒ–æ•°æ®</span>
        </div>
      </div>

      <div class="form-group">
        <div class="form-label">æ˜¯å¦æœ‰ Baseline <span class="optional">é€‰å¡«</span></div>
        <select class="form-select" id="fBaseline">
          <option value="no">æ— ï¼ˆé¦–æ¬¡è¯„æµ‹ï¼‰</option>
          <option value="yes">æœ‰ï¼ˆä¸æ—§ç‰ˆ/ç«å“å¯¹æ¯”ï¼‰</option>
        </select>
      </div>
    </div>

    <div class="panel-section">
      <button class="generate-btn" id="generateBtn" onclick="generate()">
        <div class="spinner"></div>
        <span class="btn-text">ç”Ÿæˆè¯„æµ‹æ–¹æ¡ˆ</span>
      </button>
    </div>

  </div>

  <div class="right-panel">
    <div class="output-header">
      <div class="output-tabs">
        <button class="tab active" id="tab-preview" onclick="switchTab('preview')">ğŸ“„ æ–¹æ¡ˆé¢„è§ˆ</button>
        <button class="tab" id="tab-raw" onclick="switchTab('raw')">&lt;/&gt; Markdown æºç </button>
        <button class="tab" id="tab-prompt" onclick="switchTab('prompt')">âš™ Prompt ç¼–è¾‘</button>
      </div>
      <div class="output-actions" id="outputActions" style="display:none">
        <button class="btn-sm btn-secondary" onclick="copyMarkdown()">å¤åˆ¶ MD</button>
      </div>
    </div>

    <div class="output-body" id="outputBody">

      <div class="empty-state" id="emptyState">
        <div class="big-text">EvalGen</div>
        <div class="sub-text">å¡«å†™å·¦ä¾§è¡¨å•ï¼Œç”Ÿæˆä¸“ä¸š AI è¯„æµ‹æ–¹æ¡ˆå’Œé¢„æœŸæŠ¥å‘Šæ¡†æ¶</div>
        <div class="hint-grid">
          <div class="hint-card">
            <div class="hint-icon">ğŸ¯</div>
            <div class="hint-title">è‡ªåŠ¨åˆ†æä»»åŠ¡ç‰¹æ€§</div>
            <div class="hint-desc">åˆ¤æ–­æœ‰æ— æ ‡å‡†ç­”æ¡ˆã€æ˜¯å¦å¤šæ¨¡æ€ã€å®‰å…¨é£é™©ç­‰çº§ç­‰ 7 ä¸ªç»´åº¦</div>
          </div>
          <div class="hint-card">
            <div class="hint-icon">ğŸ“Š</div>
            <div class="hint-title">æ¨èæŒ‡æ ‡ä½“ç³»</div>
            <div class="hint-desc">æ ¸å¿ƒæŒ‡æ ‡ + è¾…åŠ©æŒ‡æ ‡ + æŠ¤æ æŒ‡æ ‡ï¼Œè¦†ç›–å¹»è§‰ç‡ã€å®‰å…¨æ€§ç­‰</div>
          </div>
          <div class="hint-card">
            <div class="hint-icon">ğŸ“‹</div>
            <div class="hint-title">é¢„æœŸæŠ¥å‘Šæ¡†æ¶</div>
            <div class="hint-desc">è¯„æµ‹å‰é”å®šé€šè¿‡æ ‡å‡†ï¼Œç»“æŸååªéœ€å¡«æ•°å­—</div>
          </div>
          <div class="hint-card">
            <div class="hint-icon">âš™</div>
            <div class="hint-title">å…¨ç¯‡å¹…ç¼–è¾‘ Prompt</div>
            <div class="hint-desc">æ”¯æŒå®Œæ•´ç¼–è¾‘ç³»ç»Ÿ Promptï¼Œæ»¡è¶³å…¬å¸æœ¯è¯­ä¸é£æ ¼å®šåˆ¶</div>
          </div>
        </div>
      </div>

      <div class="loading-state" id="loadingState">
        <div class="loading-text">æ­£åœ¨ç”Ÿæˆâ€¦</div>
        <div class="loading-steps" id="loadingSteps">
          <div class="loading-step active" id="step1"><div class="step-dot"></div>è§£æä»»åŠ¡ç‰¹æ€§</div>
          <div class="loading-step" id="step2"><div class="step-dot"></div>æ¨èæŒ‡æ ‡ä½“ç³»</div>
          <div class="loading-step" id="step3"><div class="step-dot"></div>ç”Ÿæˆæ•°æ®é›†å»ºè®®</div>
          <div class="loading-step" id="step4"><div class="step-dot"></div>è¾“å‡ºè¯„æµ‹æ–¹æ¡ˆ</div>
          <div class="loading-step" id="step5"><div class="step-dot"></div>æ„å»ºæŠ¥å‘Šæ¡†æ¶</div>
        </div>
      </div>

      <div class="result-content" id="resultPreview">
        <div class="markdown-preview" id="markdownPreview"></div>
      </div>

      <div class="result-content" id="resultRaw">
        <div class="markdown-raw"><pre id="markdownRaw"></pre></div>
      </div>

      <div class="result-content" id="resultPrompt">
        <div class="prompt-panel">
          <div class="prompt-block">
            <div class="prompt-block-header">
              <div class="prompt-title" style="color:white">âš™ ç³»ç»Ÿ Promptï¼ˆå¯å…¨ç¯‡å¹…ç¼–è¾‘ï¼‰</div>
              <button class="btn-sm" style="background:rgba(255,255,255,0.12);color:white;font-size:11px;"
                onclick="resetPrompt()">æ¢å¤é»˜è®¤</button>
            </div>
            <div class="prompt-body">
              <textarea class="prompt-textarea" id="fullPrompt"></textarea>
              <div class="prompt-actions">
                <button class="btn-sm btn-primary" onclick="savePrompt()">ä¿å­˜ Prompt</button>
                <button class="btn-sm btn-secondary" onclick="copyFullPrompt()">å¤åˆ¶</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const DEFAULT_SYSTEM_PROMPT = `ä½ æ˜¯ EvalGenï¼Œä¸€ä¸ªä¸“ä¸šçš„ AI äº§å“è¯„æµ‹è®¾è®¡åŠ©æ‰‹ï¼ŒæœåŠ¡äº AI äº§å“ç»ç†å›¢é˜Ÿã€‚

# ä»»åŠ¡è¯´æ˜
æ ¹æ®ç”¨æˆ·æä¾›çš„ AI åŠŸèƒ½ä¿¡æ¯ï¼Œç”Ÿæˆä¸€ä»½ç»“æ„å®Œæ•´ã€å†…å®¹ä¸“ä¸šçš„è¯„æµ‹è®¾è®¡æ–¹æ¡ˆã€‚

---

# ç¬¬ä¸€æ­¥ï¼šä»»åŠ¡ç‰¹æ€§åˆ†æ

å¯¹ä»¥ä¸‹ 7 ä¸ªç»´åº¦é€ä¸€åšå‡ºåˆ¤æ–­ï¼Œæ ¼å¼ä¸ºï¼š**ç»´åº¦åç§°**ï¼šæ˜¯ / å¦ / é«˜ / ä¸­ / ä½ï¼ˆé™„ 1 å¥åˆ¤æ–­ç†ç”±ï¼‰ï¼Œä»¥è¡¨æ ¼å½¢å¼è¾“å‡ºã€‚

1. **æœ‰æ— æ ‡å‡†ç­”æ¡ˆ**ï¼šåŠŸèƒ½æè¿°ä¸­å«"ç”Ÿæˆ""åˆ›ä½œ""å»ºè®®""æ¨è""å¯¹è¯"â†’ æ— æ ‡å‡†ç­”æ¡ˆï¼›å«"åˆ†ç±»""æŠ½å–""åˆ¤æ–­""è¯†åˆ«"â†’ æœ‰æ ‡å‡†ç­”æ¡ˆ
2. **æ˜¯å¦ä¸ªæ€§åŒ–**ï¼šè¾“å‡ºå› ç”¨æˆ·å†å²/åå¥½/èº«ä»½ä¸åŒè€Œä¸åŒ â†’ æ˜¯ï¼›åŒä¸€è¾“å…¥å¯¹æ‰€æœ‰ç”¨æˆ·è¾“å‡ºç›¸åŒ â†’ å¦
3. **æ˜¯å¦å¤šæ¨¡æ€**ï¼šè¾“å…¥æˆ–è¾“å‡ºæ¶‰åŠå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ â†’ æ˜¯ï¼›çº¯æ–‡æœ¬ â†’ å¦
4. **æ˜¯å¦å¤šè½®äº¤äº’**ï¼šåœºæ™¯å«"å¯¹è¯""è¿½é—®""ä¸Šä¸‹æ–‡è®°å¿†" â†’ æ˜¯ï¼›å•æ¬¡è¾“å…¥è¾“å‡º â†’ å¦
5. **å®‰å…¨é£é™©ç­‰çº§**ï¼šç”¨æˆ·ç¾¤ä½“å«æœªæˆå¹´/åŒ»ç–—/é‡‘è/æ³•å¾‹ â†’ é«˜ï¼›æ™®é€š C ç«¯ â†’ ä¸­ï¼›å†…éƒ¨å·¥å…·/B ç«¯ â†’ ä½
6. **å®æ—¶æ€§æ•æ„Ÿåº¦**ï¼šåŠŸèƒ½ä¾èµ–æœ€æ–°ä¿¡æ¯ï¼ˆæ–°é—»/ä»·æ ¼/åº“å­˜ï¼‰â†’ é«˜ï¼›ä¾èµ–ç›¸å¯¹ç¨³å®šçŸ¥è¯† â†’ ä½
7. **è¾“å‡ºç¡®å®šæ€§è¦æ±‚**ï¼šæ˜ç¡®è¦æ±‚æ ¼å¼/ç»“æ„/å¿…å¡«å­—æ®µ â†’ é«˜ï¼›è‡ªç”±ç”Ÿæˆ â†’ ä½

---

# ç¬¬äºŒæ­¥ï¼šæŒ‡æ ‡ä½“ç³»ï¼ˆä¸‰å±‚ç»“æ„ï¼‰

**å±‚çº§å®šä¹‰ï¼š**
- æ ¸å¿ƒæŒ‡æ ‡ï¼ˆ1-3 ä¸ªï¼‰ï¼šç›´æ¥å¯¹åº”ç”¨æˆ·çš„"æˆåŠŸå®šä¹‰"ï¼Œæ˜¯ä¸Šçº¿ä¸å¦çš„å†³å®šæ€§ä¾æ®
- è¾…åŠ©æŒ‡æ ‡ï¼ˆ2-5 ä¸ªï¼‰ï¼šå¤šç»´åº¦åæ˜ è´¨é‡ï¼Œè¾…åŠ©åˆ¤æ–­ï¼Œä¸ç›´æ¥å†³å®šä¸Šçº¿
- æŠ¤æ æŒ‡æ ‡ï¼ˆ1-3 ä¸ªï¼‰ï¼šåº•çº¿æŒ‡æ ‡ï¼Œä»»æ„ä¸€ä¸ªä¸è¾¾æ ‡åˆ™ç›´æ¥é˜»å¡ä¸Šçº¿ï¼Œæ— è®ºæ ¸å¿ƒæŒ‡æ ‡å¤šå¥½

**é€‰æŒ‡æ ‡è§„åˆ™ï¼ˆä¸¥æ ¼æŒ‰ä»»åŠ¡ç‰¹æ€§é€‰æ‹©ï¼Œä¸å †ç Œï¼‰ï¼š**

| æ¡ä»¶ | æ¨èæŒ‡æ ‡ |
|------|----------|
| æœ‰æ ‡å‡†ç­”æ¡ˆ | å‡†ç¡®ç‡ Accuracyã€F1 Score |
| æ— æ ‡å‡†ç­”æ¡ˆ + æ–‡æœ¬ç”Ÿæˆ | ç›¸å…³æ€§ã€æµç•…æ€§ã€å¹»è§‰ç‡ |
| å¤šè½®å¯¹è¯ | ä¸Šä¸‹æ–‡ä¸€è‡´æ€§ã€æ„å›¾è·Ÿè¸ªç‡ |
| ä¸ªæ€§åŒ–ä»»åŠ¡ | ç”¨æˆ·æ»¡æ„åº¦ã€é‡‡çº³ç‡ï¼ˆè€Œéç¾¤ä½“å‡†ç¡®ç‡ï¼‰ |
| å®‰å…¨é£é™©é«˜ | å®‰å…¨é€šè¿‡ç‡ï¼ˆæŠ¤æ ï¼Œå¿…é¡» â‰¥ 99.9%ï¼‰ |
| æœ‰æ ¼å¼è¦æ±‚ | Instruction Following Rate |
| æ‰€æœ‰åœ¨çº¿æœåŠ¡ | P99 å»¶è¿Ÿï¼ˆæŠ¤æ ï¼‰ |

**å¯¹æ¯ä¸ªæŒ‡æ ‡å¿…é¡»è¾“å‡ºï¼š**
- æŒ‡æ ‡åç§°ä¸å®šä¹‰ï¼ˆ1 å¥è¯ï¼‰
- è¯„æµ‹æ–¹å¼ï¼ˆè‡ªåŠ¨è¯„æµ‹ / äººå·¥æ ‡æ³¨ / LLM Judgeï¼‰
- è¡Œä¸šå‚è€ƒé˜ˆå€¼ï¼ˆé™„æ¥æºè¯´æ˜ï¼‰

---

# ç¬¬ä¸‰æ­¥ï¼šæ•°æ®é›†è®¾è®¡å»ºè®®

å¿…é¡»åŒ…å«ï¼š
1. **æ¨èæ•°æ®é‡**ï¼šç»™å‡ºå…·ä½“æ•°å­—èŒƒå›´ï¼ˆå¦‚"å»ºè®® 500â€“1000 æ¡"ï¼‰ï¼Œå¹¶è¯´æ˜ç†ç”±
2. **åˆ†å±‚ç­–ç•¥**ï¼š
   - æ­£å¸¸ caseï¼ˆå»ºè®® 60â€“70%ï¼‰ï¼šè¦†ç›–æ ¸å¿ƒä½¿ç”¨åœºæ™¯
   - Edge caseï¼ˆå»ºè®® 20â€“30%ï¼‰ï¼šè¾¹ç•Œæƒ…å†µï¼Œå¦‚è¶…é•¿è¾“å…¥ã€ç©ºè¾“å…¥ã€ç‰¹æ®Šå­—ç¬¦ã€æ­§ä¹‰è¡¨è¾¾
   - å¯¹æŠ—æ ·æœ¬ï¼ˆå»ºè®® 10%ï¼‰ï¼šä¸“é—¨è®¾è®¡ç”¨äºæš´éœ²æ¨¡å‹å¼±ç‚¹çš„ case
3. **æ ‡æ³¨è¦æ±‚**ï¼š
   - è‹¥æœ‰æ ‡å‡†ç­”æ¡ˆï¼šè¯´æ˜ ground truth çš„å­—æ®µå’Œæ ¼å¼
   - è‹¥æ— æ ‡å‡†ç­”æ¡ˆï¼šæä¾›è¯„åˆ†ç»´åº¦ï¼ˆå¦‚ç›¸å…³æ€§ 1-5 åˆ†æ ‡å‡†ï¼‰ï¼Œä»¥åŠæ ‡æ³¨ä¸€è‡´æ€§è¦æ±‚ï¼ˆCohen's Îº â‰¥ 0.7ï¼‰

---

# ç¬¬å››æ­¥ï¼šè¯„æµ‹æ–¹å¼æ¨è

æ ¹æ®ä»»åŠ¡ç‰¹æ€§ç»™å‡ºæ¨èç»„åˆï¼Œè¯´æ˜å„éƒ¨åˆ†æ‰§è¡Œæ–¹å¼ï¼š

| è¯„æµ‹æ–¹å¼ | é€‚ç”¨æ¡ä»¶ | æ³¨æ„äº‹é¡¹ |
|----------|----------|----------|
| è‡ªåŠ¨è¯„æµ‹ | æœ‰æ ‡å‡†ç­”æ¡ˆ + æ•°æ®é‡å¤§ | éœ€æå‰å‡†å¤‡ ground truth |
| LLM Judge | æ— æ ‡å‡†ç­”æ¡ˆ + é¢„ç®—æœ‰é™ | éœ€è®¾è®¡ judge promptï¼Œæ³¨æ„ä½ç½®åå·® |
| äººå·¥æ ‡æ³¨ | é«˜é£é™©åœºæ™¯ + ç»†ç²’åº¦åˆ¤æ–­ | éœ€æ ‡æ³¨æŒ‡å—ï¼Œè®¡ç®—æ ‡æ³¨ä¸€è‡´æ€§ |
| A/B Test | æœ‰ baseline + æ—¶é—´å……è£• | éœ€ä¿è¯æµé‡åˆ†é…å’Œç»Ÿè®¡æ˜¾è‘—æ€§ |

è‹¥æ—¶é—´ç´§å¼ ï¼ˆ< 2 å‘¨ï¼‰ï¼Œä¼˜å…ˆæ¨èè‡ªåŠ¨è¯„æµ‹ + å°‘é‡äººå·¥æŠ½æ£€ã€‚

---

# ç¬¬äº”æ­¥ï¼šé€šè¿‡æ ‡å‡†

è¾“å‡ºæ ¼å¼ï¼š

> **ç»¼åˆé€šè¿‡æ¡ä»¶**ï¼šæ‰€æœ‰æ ¸å¿ƒæŒ‡æ ‡è¾¾æ ‡ + æ‰€æœ‰æŠ¤æ æŒ‡æ ‡è¾¾æ ‡ = å¯ä¸Šçº¿

å¯¹æ¯ä¸ªæ ¸å¿ƒæŒ‡æ ‡å’ŒæŠ¤æ æŒ‡æ ‡åˆ—å‡ºï¼š
- è¾¾æ ‡é˜ˆå€¼
- æœ‰æ¡ä»¶é€šè¿‡æƒ…å†µï¼ˆä¾‹ï¼šæŸæŒ‡æ ‡å·® 2pp ä½†æœ‰æ˜ç¡®æ”¹è¿›è®¡åˆ’ï¼Œå¯å¸¦æ¡ä»¶ä¸Šçº¿ï¼‰

---

# ç¬¬å…­æ­¥ï¼šé¢„æœŸè¯„æµ‹æŠ¥å‘Šæ¡†æ¶

ç”Ÿæˆä¸€ä»½å¯åœ¨è¯„æµ‹å®Œæˆåç›´æ¥å¡«å†™çš„æŠ¥å‘Šæ¡†æ¶ã€‚**å¿…é¡»åŒ…å«å¯å¡«å†™çš„è¡¨æ ¼**ï¼Œä¸èƒ½åªæœ‰æ ‡é¢˜ã€‚

æŠ¥å‘Šç»“æ„ï¼š
1. æ‰§è¡Œæ‘˜è¦ï¼ˆç»“è®ºï¼šé€šè¿‡ / æœ‰æ¡ä»¶é€šè¿‡ / ä¸é€šè¿‡ï¼‰â€” å¾…å¡«
2. æ ¸å¿ƒæŒ‡æ ‡ç»“æœè¡¨ï¼ˆå«ï¼šæŒ‡æ ‡ | ç›®æ ‡å€¼ | å®æµ‹å€¼ | æ˜¯å¦è¾¾æ ‡ï¼‰â€” è‡ªåŠ¨ç”Ÿæˆè¡¨å¤´å’Œç›®æ ‡å€¼ï¼Œå®æµ‹å€¼ç•™ç©º
3. äº®ç‚¹å‘ç° â€” é¢„ç•™ç©ºç™½
4. é£é™©ä¸é—®é¢˜ â€” é¢„ç•™ç©ºç™½
5. åˆ†åœºæ™¯åˆ†æï¼ˆæŒ‰æµ‹è¯•é›†åˆ†å±‚é€ç±»æŠ¥å‘Šï¼‰â€” è‡ªåŠ¨ç”Ÿæˆè¡¨æ ¼æ¡†æ¶
6. ä¸ baseline å¯¹æ¯”ï¼ˆå¦‚æœ‰ baseline åˆ™åŒ…å«æ­¤èŠ‚ï¼‰
7. ä¸Šçº¿å»ºè®® â€” é¢„ç•™ç©ºç™½

---

# è¾“å‡ºæ ¼å¼è¦æ±‚

- ä½¿ç”¨ Markdown æ ¼å¼
- æ¯ç« èŠ‚ç”¨ ## æ ‡é¢˜
- è¡¨æ ¼ç”¨æ ‡å‡† Markdown è¡¨æ ¼è¯­æ³•
- è¯­è¨€ä¸“ä¸šä½†ä¸å †ç Œæœ¯è¯­ï¼Œæ¯ä¸ªå»ºè®®éƒ½è¦æœ‰ä¾æ®
- æœ€åæç¤º PMï¼šæ‰€æœ‰é˜ˆå€¼å’Œå»ºè®®å‡ä¸ºè¡Œä¸šå‚è€ƒå€¼ï¼Œå¯æ ¹æ®å…¬å¸å®é™…æƒ…å†µè°ƒæ•´

---

# ç¤ºä¾‹è¾“å‡ºç‰‡æ®µï¼ˆä¾›å‚è€ƒæ ¼å¼ï¼‰

## äºŒã€æŒ‡æ ‡ä½“ç³»

### æ ¸å¿ƒæŒ‡æ ‡

| æŒ‡æ ‡ | å®šä¹‰ | è¯„æµ‹æ–¹å¼ | ç›®æ ‡é˜ˆå€¼ | å‚è€ƒæ¥æº |
|------|------|----------|----------|----------|
| æ„å›¾è¯†åˆ«å‡†ç¡®ç‡ | æ¨¡å‹æ­£ç¡®ç†è§£ç”¨æˆ·é—®é¢˜ç±»åˆ«çš„æ¯”ä¾‹ | è‡ªåŠ¨è¯„æµ‹ï¼ˆå¯¹æ¯” ground truth æ ‡ç­¾ï¼‰ | â‰¥ 85% | è¡Œä¸šæ™ºèƒ½å®¢æœè¯„æµ‹é€šç”¨åŸºå‡† |
| å›å¤ç›¸å…³æ€§ | å›å¤å†…å®¹ä¸ç”¨æˆ·é—®é¢˜çš„ç›¸å…³ç¨‹åº¦ï¼ˆ1-5åˆ†ï¼‰ | LLM Judge | å¹³å‡ â‰¥ 4.0 | å†…éƒ¨å†å²è¯„æµ‹æ•°æ® |

### æŠ¤æ æŒ‡æ ‡

| æŒ‡æ ‡ | å®šä¹‰ | é˜ˆå€¼ | ä¸è¾¾æ ‡å¤„ç† |
|------|------|------|------------|
| å®‰å…¨å†…å®¹é€šè¿‡ç‡ | æ— æœ‰å®³/è¿è§„å†…å®¹çš„å›å¤æ¯”ä¾‹ | â‰¥ 99.5% | ç›´æ¥é˜»å¡ä¸Šçº¿ï¼Œéœ€äººå·¥å®¡æŸ¥ |
| P99 å“åº”å»¶è¿Ÿ | 99% è¯·æ±‚çš„å“åº”æ—¶é—´ | â‰¤ 3000ms | ç›´æ¥é˜»å¡ä¸Šçº¿ï¼Œéœ€æ€§èƒ½ä¼˜åŒ– |

---

è®°ä½ï¼šç”Ÿæˆå†…å®¹å¿…é¡»åŸºäºç”¨æˆ·æä¾›çš„å…·ä½“åŠŸèƒ½ä¿¡æ¯åšå®šåˆ¶åŒ–æ¨èï¼Œä¸è¦ç»™å‡ºä¸ä»»åŠ¡æ— å…³çš„é€šç”¨å»ºè®®ã€‚`;

let state = {
  apiKey: '',
  systemPrompt: DEFAULT_SYSTEM_PROMPT,
  generatedMd: '',
  formData: {},
  hasResult: false
};

function saveApiKey() {
  const val = document.getElementById('apiKeyInput').value.trim();
  state.apiKey = val;
  try { val ? localStorage.setItem('evalgen_apiKey', val) : localStorage.removeItem('evalgen_apiKey'); } catch (_) {}
  showToast(val ? 'âœ“ API Key å·²ä¿å­˜' : 'âœ“ å·²æ¸…é™¤ï¼Œå°†ä½¿ç”¨ Mock é¢„è§ˆ');
}

function toggleTag(el) { el.classList.toggle('active'); }

function getActiveTags(containerId) {
  const c = document.getElementById(containerId);
  return Array.from(c.querySelectorAll('.tag.active')).map(t => t.textContent.trim());
}

function switchTab(tab) {
  ['preview','raw','prompt'].forEach(t => {
    document.getElementById('tab-'+t).classList.toggle('active', t===tab);
    const r = 'result' + t.charAt(0).toUpperCase() + t.slice(1);
    document.getElementById(r).classList.toggle('active', t===tab);
  });
}

function buildUserMessage(data) {
  const audienceStr = data.audience.length ? data.audience.join('ã€') : 'æœªæŒ‡å®š';
  const outputStr = data.output.length ? data.output.join('ã€') : 'æ–‡æœ¬';
  const timeMap = {tight:'ç´§ï¼ˆ< 2å‘¨ï¼‰', medium:'ä¸­ç­‰ï¼ˆ2â€“4å‘¨ï¼‰', loose:'å®½æ¾ï¼ˆ> 1ä¸ªæœˆï¼‰'};
  const baselineStr = data.baseline === 'yes' ? 'æœ‰ï¼ˆéœ€å¯¹æ¯”åˆ†æï¼‰' : 'æ— ï¼ˆé¦–æ¬¡è¯„æµ‹ï¼‰';
  return `è¯·ä¸ºä»¥ä¸‹ AI åŠŸèƒ½ç”Ÿæˆå®Œæ•´çš„è¯„æµ‹è®¾è®¡æ–¹æ¡ˆï¼Œä¸¥æ ¼æŒ‰ç…§å…­æ­¥ç»“æ„è¾“å‡ºï¼š

---

## å¾…è¯„æµ‹åŠŸèƒ½ä¿¡æ¯

**åŠŸèƒ½æè¿°ï¼š** ${data.description}

**ç”¨æˆ·åœºæ™¯ï¼š** ${data.scene}

**PM çš„æˆåŠŸå®šä¹‰ï¼ˆè¿™æ˜¯é€‰æŒ‡æ ‡çš„æ ¸å¿ƒä¾æ®ï¼‰ï¼š** ${data.success}

**ä¸Šçº¿æ—¶é—´å‹åŠ›ï¼š** ${timeMap[data.time]}

**ç”¨æˆ·ç¾¤ä½“ï¼š** ${audienceStr}

**è¾“å‡ºå½¢å¼ï¼š** ${outputStr}

**æ˜¯å¦æœ‰ Baselineï¼š** ${baselineStr}

---

è¯·ä¾æ¬¡è¾“å‡ºï¼šä»»åŠ¡ç‰¹æ€§åˆ†æ â†’ æŒ‡æ ‡ä½“ç³» â†’ æ•°æ®é›†è®¾è®¡ â†’ è¯„æµ‹æ–¹å¼ â†’ é€šè¿‡æ ‡å‡† â†’ é¢„æœŸæŠ¥å‘Šæ¡†æ¶ã€‚
æ‰€æœ‰è¡¨æ ¼å¿…é¡»å¡«å†™å®Œæ•´ï¼ŒæŠ¥å‘Šæ¡†æ¶ä¸­çš„æŒ‡æ ‡è¡¨æ ¼éœ€æ ¹æ®ä¸Šé¢æ¨èçš„æŒ‡æ ‡è‡ªåŠ¨ç”Ÿæˆè¡¨å¤´å’Œç›®æ ‡å€¼ã€‚`;
}

async function callGLMAPI(apiKey, systemPrompt, userMessage) {
  const response = await fetch('https://open.bigmodel.cn/api/paas/v4/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + apiKey
    },
    body: JSON.stringify({
      model: 'glm-4-flash',
      max_tokens: 4000,
      temperature: 0.3,
  top_p: 0.9,
      messages: [
        { role: 'system', content: systemPrompt },
        { role: 'user', content: userMessage }
      ]
    })
  });
  if (!response.ok) {
    const err = await response.json().catch(() => ({}));
    throw new Error(err.error?.message || err.message || `HTTP ${response.status}`);
  }
  const data = await response.json();
  return data.choices?.[0]?.message?.content || '';
}

function generateMockOutput(formData) {
  const audienceStr = formData.audience.length ? formData.audience.join('ã€') : 'æœªæŒ‡å®š';
  const outputStr = formData.output.length ? formData.output.join('ã€') : 'æ–‡æœ¬';
  const timeMap = {tight:'ç´§ï¼ˆ< 2å‘¨ï¼‰', medium:'ä¸­ç­‰ï¼ˆ2â€“4å‘¨ï¼‰', loose:'å®½æ¾ï¼ˆ> 1ä¸ªæœˆï¼‰'};
  const baselineSection = formData.baseline === 'yes' ? `
## ä¸ Baseline å¯¹æ¯”

| æŒ‡æ ‡ | Baseline | å½“å‰ç‰ˆæœ¬ | å˜åŒ– |
| --- | --- | --- | --- |
| _å¾…å¡«å…¥_ | _å¾…å¡«å…¥_ | _å¾…å¡«å…¥_ | _å¾…å¡«å…¥_ |
` : '';

  return `# ${formData.description} è¯„æµ‹æ–¹æ¡ˆ

## 1. ä»»åŠ¡ç‰¹æ€§åˆ†æ

| ç»´åº¦ | åˆ¤æ–­ | è¯´æ˜ |
| --- | --- | --- |
| æœ‰æ— å”¯ä¸€æ ‡å‡†ç­”æ¡ˆ | å¾… LLM åˆ†æ | æ ¹æ®åŠŸèƒ½æè¿°åˆ¤æ–­ |
| æ˜¯å¦ä¸ªæ€§åŒ– | å¾… LLM åˆ†æ | æ ¹æ®ç”¨æˆ·ç¾¤ä½“åˆ¤æ–­ |
| æ˜¯å¦å¤šæ¨¡æ€ | ${outputStr.includes('å›¾ç‰‡') || outputStr.includes('è¯­éŸ³') ? 'æ˜¯' : 'å¦'} | è¾“å‡ºå½¢å¼ï¼š${outputStr} |
| æ˜¯å¦å¤šè½®äº¤äº’ | å¾… LLM åˆ†æ | æ ¹æ®åœºæ™¯åˆ¤æ–­ |
| å®‰å…¨é£é™©ç­‰çº§ | ${formData.audience.some(a=>['æœªæˆå¹´äºº','åŒ»ç–—åœºæ™¯','é‡‘èåœºæ™¯'].includes(a)) ? 'é«˜' : 'ä¸­'} | ç”¨æˆ·ç¾¤ä½“ï¼š${audienceStr} |
| å®æ—¶æ€§æ•æ„Ÿåº¦ | å¾… LLM åˆ†æ | â€” |
| è¾“å‡ºç¡®å®šæ€§è¦æ±‚ | å¾… LLM åˆ†æ | â€” |

## 2. æŒ‡æ ‡ä½“ç³»

### æ ¸å¿ƒæŒ‡æ ‡ï¼ˆ1-3 ä¸ªï¼‰

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
| --- | --- | --- |
| _æ ¹æ®æˆåŠŸå®šä¹‰è‡ªåŠ¨æ¨è_ | _å¾…å¡«å…¥_ | â€” |

### è¾…åŠ©æŒ‡æ ‡ï¼ˆ2-5 ä¸ªï¼‰

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
| --- | --- | --- |
| _å¾…å¡«å…¥_ | _å¾…å¡«å…¥_ | â€” |

### æŠ¤æ æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
| --- | --- | --- |
| å®‰å…¨æ€§é€šè¿‡ç‡ | â‰¥ 99.9% | å¦‚æœ‰æ•æ„Ÿåœºæ™¯ |
| å¹»è§‰ç‡ | â‰¤ 5% | ç”Ÿæˆç±»ä»»åŠ¡ |

## 3. æ•°æ®é›†è®¾è®¡å»ºè®®

- **æ¨èæ•°é‡ï¼š** åˆ†ç±»ä»»åŠ¡ â‰¥ 500 æ¡ï¼›ç”Ÿæˆä»»åŠ¡äººå·¥è¯„å®š â‰¥ 100 æ¡
- **åˆ†å±‚ï¼š** æ­£å¸¸ case 70% / edge case 20% / å¯¹æŠ—æ ·æœ¬ 10%
- **æ—¶é—´å‹åŠ›ï¼š** ${timeMap[formData.time]} â€” å¯é…Œæƒ…è°ƒæ•´è‡ªåŠ¨åŒ–æ¯”ä¾‹

## 4. è¯„æµ‹æ–¹å¼æ¨è

æ ¹æ®ä»»åŠ¡ç‰¹æ€§å’Œæ—¶é—´å‹åŠ›ï¼Œæ¨èè‡ªåŠ¨åŒ– / LLM Judge / äººå·¥çš„ç»„åˆæ–¹æ¡ˆã€‚_å…·ä½“ç”± LLM æ ¹æ®ä»»åŠ¡ç‰¹æ€§ç”Ÿæˆã€‚_

## 5. é€šè¿‡æ ‡å‡†

æ‰€æœ‰æ ¸å¿ƒæŒ‡æ ‡è¾¾æ ‡ + æŠ¤æ æŒ‡æ ‡è¾¾æ ‡ï¼Œæ–¹å¯ä¸Šçº¿ã€‚_é˜ˆå€¼ç”± LLM æ ¹æ®è¡Œä¸šå‚è€ƒå€¼ç”Ÿæˆã€‚_

## 6. é¢„æœŸè¯„æµ‹æŠ¥å‘Šæ¡†æ¶

### æ‰§è¡Œæ‘˜è¦

- è¯„æµ‹ç»“è®ºï¼šâ–¡ é€šè¿‡ / â–¡ æœ‰æ¡ä»¶é€šè¿‡ / â–¡ ä¸é€šè¿‡
- ä¸€å¥è¯æ€»ç»“ï¼š_å¾…å¡«å…¥_

### æ ¸å¿ƒæŒ‡æ ‡ç»“æœè¡¨

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®æµ‹å€¼ | æ˜¯å¦è¾¾æ ‡ |
| --- | --- | --- | --- |
| _å¾…å¡«å…¥_ | _å¾…å¡«å…¥_ | _å¾…å¡«å…¥_ | _å¾…å¡«å…¥_ |
${baselineSection}
---

> æ­¤ä¸ºæ¼”ç¤ºç”¨æ¨¡æ¿ï¼Œå®é™…å†…å®¹éœ€ç”± LLM æ ¹æ® Prompt ç”Ÿæˆã€‚å¡«å†™è¡¨å•åç‚¹å‡»ã€Œç”Ÿæˆè¯„æµ‹æ–¹æ¡ˆã€å¯çœ‹åˆ°åŸºäºè¡¨å•æ•°æ®çš„ç»“æ„é¢„è§ˆã€‚
`;
}

async function generate() {
  const desc = document.getElementById('fDescription').value.trim();
  const scene = document.getElementById('fScene').value.trim();
  const success = document.getElementById('fSuccess').value.trim();

  if (!desc || !scene || !success) {
    showToast('âš  è¯·å¡«å†™å¿…å¡«é¡¹ï¼ˆåŠŸèƒ½æè¿°ã€ç”¨æˆ·åœºæ™¯ã€æˆåŠŸå®šä¹‰ï¼‰');
    return;
  }

  state.formData = {
    description: desc,
    scene,
    success,
    time: document.getElementById('fTime').value,
    audience: getActiveTags('audienceTags'),
    output: getActiveTags('outputTags'),
    baseline: document.getElementById('fBaseline').value
  };

  const btn = document.getElementById('generateBtn');
  btn.disabled = true;
  btn.classList.add('loading');
  document.getElementById('emptyState').style.display = 'none';
  document.getElementById('loadingState').classList.add('active');
  ['resultPreview','resultRaw','resultPrompt'].forEach(id =>
    document.getElementById(id).classList.remove('active'));
  document.getElementById('outputActions').style.display = 'none';

  const steps = ['step1','step2','step3','step4','step5'];
  const stepInterval = 3000;
  steps.forEach((id) => {
    const el = document.getElementById(id);
    el.classList.remove('done','active');
  });
  document.getElementById('step1').classList.add('active');

  let stepTimer;
  function advanceStep() {
    const idx = steps.findIndex(id => document.getElementById(id).classList.contains('active'));
    if (idx >= 0) {
      document.getElementById(steps[idx]).classList.replace('active','done');
      if (idx + 1 < steps.length) {
        document.getElementById(steps[idx + 1]).classList.add('active');
        stepTimer = setTimeout(advanceStep, stepInterval);
      }
    }
  }
  stepTimer = setTimeout(advanceStep, stepInterval);

  const systemPrompt = document.getElementById('fullPrompt').value.trim() || state.systemPrompt;
  const userMessage = buildUserMessage(state.formData);
  const apiKey = state.apiKey || document.getElementById('apiKeyInput').value.trim();
  let markdown = '';

  if (apiKey) {
    try {
      markdown = await callGLMAPI(apiKey, systemPrompt, userMessage);
    } catch (e) {
      if (stepTimer) clearTimeout(stepTimer);
      document.getElementById('loadingState').classList.remove('active');
      document.getElementById('emptyState').style.display = 'flex';
      btn.disabled = false;
      btn.classList.remove('loading');
      showToast('âš  ç”Ÿæˆå¤±è´¥ï¼š' + e.message);
      return;
    }
  } else {
    await new Promise(r => setTimeout(r, 400));
    markdown = generateMockOutput(state.formData);
  }

  state.generatedMd = markdown;
  state.hasResult = true;

  document.getElementById('markdownPreview').innerHTML = renderMarkdown(state.generatedMd);
  document.getElementById('markdownRaw').textContent = state.generatedMd;

  if (stepTimer) clearTimeout(stepTimer);
  document.getElementById('loadingState').classList.remove('active');
  switchTab('preview');
  document.getElementById('resultPreview').classList.add('active');
  document.getElementById('outputActions').style.display = 'flex';
  btn.disabled = false;
  btn.classList.remove('loading');
  showToast('âœ“ è¯„æµ‹æ–¹æ¡ˆç”Ÿæˆå®Œæˆ');
}

function renderMarkdown(md) {
  let html = md
    .replace(/^# (.+)$/gm, '<h1>$1</h1>')
    .replace(/^## (.+)$/gm, '<h2>$1</h2>')
    .replace(/^### (.+)$/gm, '<h3>$1</h3>')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.+?)\*/g, '<em>$1</em>')
    .replace(/`([^`]+)`/g, '<code>$1</code>')
    .replace(/^> (.+)$/gm, '<blockquote>$1</blockquote>')
    .replace(/(\|.+\|\n)+/g, (match) => {
      const rows = match.trim().split('\n');
      let table = '<table>';
      rows.forEach((row, i) => {
        if (row.match(/^\|[-| :]+\|$/)) return;
        const cells = row.split('|').filter((_, ci) => ci > 0 && ci < row.split('|').length - 1);
        const tag = i === 0 ? 'th' : 'td';
        table += '<tr>' + cells.map(c => `<${tag}>${c.trim()}</${tag}>`).join('') + '</tr>';
      });
      return table + '</table>';
    })
    .replace(/^[-*] (.+)$/gm, '<li>$1</li>')
    .replace(/(<li>.*<\/li>\n?)+/g, m => '<ul>' + m + '</ul>')
    .replace(/^\d+\. (.+)$/gm, '<li>$1</li>')
    .replace(/\n\n([^<\n].+)/g, '<p>$1</p>');
  return html;
}

function copyMarkdown() {
  if (!state.generatedMd) return;
  navigator.clipboard.writeText(state.generatedMd).then(() =>
    showToast('âœ“ Markdown å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'));
}

function resetPrompt() {
  document.getElementById('fullPrompt').value = DEFAULT_SYSTEM_PROMPT;
  state.systemPrompt = DEFAULT_SYSTEM_PROMPT;
  showToast('âœ“ å·²æ¢å¤é»˜è®¤ Prompt');
}

function savePrompt() {
  state.systemPrompt = document.getElementById('fullPrompt').value.trim() || DEFAULT_SYSTEM_PROMPT;
  showToast('âœ“ Prompt å·²ä¿å­˜ï¼Œä¸‹æ¬¡ç”Ÿæˆæ—¶ç”Ÿæ•ˆ');
}

function copyFullPrompt() {
  const text = document.getElementById('fullPrompt').value;
  navigator.clipboard.writeText(text).then(() => showToast('âœ“ Prompt å·²å¤åˆ¶'));
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2800);
}

document.getElementById('fullPrompt').value = DEFAULT_SYSTEM_PROMPT;
state.systemPrompt = DEFAULT_SYSTEM_PROMPT;
try {
  const stored = localStorage.getItem('evalgen_apiKey');
  if (stored) { state.apiKey = stored; document.getElementById('apiKeyInput').value = stored; }
} catch (_) {}
</script>
</body>
</html>
